---
title: "Data Story"
author: "Jeff Tsui"
date: "February 24, 2019"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Analysis on Public Crime That violate Pedestrians in New York City

###*Introduction*
Public Order Crime is an act that deviate the society's general ideas of normal social behavior and moral values. Different types of public crime can happen anywhere in the city, some borough have more crimes, other have less. By idenitifying the hotspots from the past criminal activities, it will bring caution to tourists and locals to be aware of a certain areas during certain times. 

This project aim to explore and solve:

*Have the public crime activity in New York City increased or decreased at the end of 2017?

*Which borough in New York City have the most public crime activity that violate pedestrians?

*Is there any correlation between public crime activity and weather temperature?

*Which time period of the day (00:00 - 08:00, 08:01 - 16:00, or 16:01 - 24:00) has the most crime activity?

*Where are the hotspots for public crimes that violate pedestrians?


###*Data Acquisition*
Datasets from Crime reports in NYC are availabe at [NYC Opendata](https://data.cityofnewyork.us). I will be using the datasets of [Incident Level Complaint Data - 2006 through 2017](https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Historic/qgea-i56i) The dataset contains: the incident level complaint from the beginning of January 2010 to the end of December 2017. The variables that I will be working on will be the boroughs, date of the complaints, time of the complaints, level of offenses, description of the offenses, description of the premises, suspect's age group, suspect's race, suspect's sex, victim's age group, victim's race, and victim's sex.

Dataset of daily average temperature from 2010 to 2017 in New York City is obtained from [Weather Underground](https://www.wunderground.com/). 

###*Important Fields and Information*
According to the NY Police Department post on the [The New York Job Source](http://www.nyjobsource.com/nypd.html), the NYPD shifts are divided by three 8-hours and 35 minute shifts: 11:15 PM to 7:50 AM, 7:05 AM to 3:40 PM, and 3:00 PM tp 11:35 PM. But to simplify they call the shifts: (12 to 8), (8 to 4), and (4 to 12). I will be creating 3 time period of the day correspond to the police shifts to test out whih time period of the day has the most crime.

###*Data Limitations*
Since there isn't a specific whole area weather temperature for the entire New York City that includes all five boroughs on the historical data on the Weather Underground website. I took the average temperature of the most centered borough (Manhattan). 

There are limited data on the suspect's age, race, and sex because there might be a case where the suspect was never caught. As well as there are limited data on the victim's age, race and sex because of the protection of personal information.

None of the murder crimes have any premises description in the dataset of NYC Opendata, therefore none of them was included in this project. Since this crime is one of the most serious crime and the worst crime that can happen to a pedestrian, without the  data of this crime can impact the attention that the locals and tourists would have give.

###*Data Cleaning and wrangling*
The following packages was used for data cleaning and wrangling: `tidyr`, `dplyr`, `lubridate`, `chron`, and `zoo`.

*Deleting useless columns by using e.g. df[, -c(1,2,3,4)].

*Rearranging the columns by using e.g. df[, c(2,1,3,4)].

*Renaming the columns to become more readible by using colnames.

*Used the `select()` and `filter()` function from the `dplyr` package to filter out all premises except public premises: "PARK/PLAYGROUND", "PARKING LOT/GARAGE(PUBLIC)", "BUS (NYC TRANSIT)", "OPEN AREAS (OPEN LOTS)", "BUS STOP", "STREET", "TRANSIT - NYC SUBWAY", "PUBLIC BUILDING".

*Used the `select()` and `filter()` function from the `dplyr` package to filter out all offensive except the ones that affects pedestrians: "ARSON", "ASSAULT & RELATED OFFENSES", "DANGEROUS WEAPONS", "FELONY ASSAULT", "HARRASSMENT", "KIDNAPPING", "MURDER & NON-NEGL. MANSLAUGHTER", "RAPE", "ROBBERY", "SEX CRIMES".

*Used the `year` function from the `lubridate` package to add a new column for the year.

*Used the `yearmon` function from the `zoo` package to add a new column for the year with month.

*Used the `chron` function from the `chron` package to convert the rows in the Complaint time column into the formate of "h:m:s"

###*Preliminary exploration*
Load  the library
```{r message = FALSE}
library(dplyr)
library(tidyr)
library(scales)
library(ggplot2)
library(plyr)
library(lubridate)
library(zoo)
library(gtools)
library(chron)
```


Load the dataframe 
``` {r echo = FALSE}
AllComplaint <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data-Wrangling-Capstone-Project/New/ComplaintTempFinal2.csv", header = T)[,-1]
AllComplaint$Year <- year(as.Date(AllComplaint$Complaint_Date, "%Y-%m-%d"))
AllComplaint <- transform(AllComplaint, yearmon = as.yearmon(AllComplaint$Complaint_Date))
AllComplaint<- AllComplaint[, c(1, 2, 16, 17, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)]
colnames(AllComplaint)[colnames(AllComplaint) == "yearmon"] <- "Year_Month"


Shift1 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shifts/Shift1Final.csv", header = T, stringsAsFactors = F)[,-1]
Shift1$Year <- year(as.Date(Shift1$Complaint_Date, "%Y-%m-%d"))
Shift1 <- transform(Shift1, yearmon = as.yearmon(Shift1$Complaint_Date))
Shift1<- Shift1[, c(1, 2, 16, 17, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)]
colnames(Shift1)[colnames(Shift1) == "yearmon"] <- "Year_Month"

Shift2 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shifts/Shift2Final.csv", header = T, stringsAsFactors = F)[,-1]
Shift2$Complaint_Date <- as.Date(Shift2$Complaint_Date, "%m/%d/%Y")
Shift2$Year <- year(as.Date(Shift2$Complaint_Date, "%Y/%m/%d"))
Shift2 <- transform(Shift2, yearmon = as.yearmon(Shift2$Complaint_Date))
Shift2<- Shift2[, c(1, 2, 16, 17, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)]
colnames(Shift2)[colnames(Shift2) == "yearmon"] <- "Year_Month"

Shift3 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shifts/Shift3Final.csv", header = T, stringsAsFactors = F)[,-1]
Shift3$Year <- year(as.Date(Shift3$Complaint_Date, "%Y-%m-%d"))
Shift3 <- transform(Shift3, yearmon = as.yearmon(Shift3$Complaint_Date))
Shift3<- Shift3[, c(1, 2, 16, 17, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)]
colnames(Shift3)[colnames(Shift3) == "yearmon"] <- "Year_Month"
```

The dataframe only included the reported complaints of crimes that violates other people in the public. The public premises includes: "bus stop", "open areas (open lots)", "park/playground", "public buildings", "street", "transit (bus)", and "transit (subway)".  The public crimes includes: "arson", "assault and related offenses", "danagerous weapons", "felony assault", "harrassment", "kidnapping", "rape", "robbery", and "sex crimes". The complaint reported for public crimes are 11.8% of all reported crimes between 2010 to 2017.

Analysis of Crime Complaints that Violates Other People In The Public
=====================================================================================
###Looking at the total public crime complaints annually between 2010 to 2017

``` {r echo = FALSE}
ggplot(AllComplaint, aes(x = Year, y = (..count..))) + 
  geom_bar(col = "Red") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Per Year Between 2010 to 2017") +
  theme(plot.title = element_text(hjust = 0.5))
```

``` {r echo = FALSE}
ggplot(data = AllComplaint, aes(Year)) + 
  geom_line(stat = "count") + 
  geom_point(stat = "count") + 
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Per Year Between 2010 to 2017") +
  theme(plot.title = element_text(hjust = 0.5))
```

``` {r echo = TRUE}
#Number of public crime complaints in 2010
length(which(AllComplaint$Year == 2010))
#Number of public crime complaints in 2017
length(which(AllComplaint$Year == 2017))
#The percentage change in public crime complaints from 2010 to 2017
A <- length(which(AllComplaint$Year == 2010))
B <- length(which(AllComplaint$Year == 2017))
(A-B)/A
```

There is a decrease in crime complaints by looking at the first bar graph. But the line graph shows the changes more clearly that there is a decrease in public crimes between 2010 to 2017. By using the length, which function, the number of public crime complaints in 2010 and 2017 were found to be 62713 and 52440 respectively. The percentage change between 2010 and 2017 in public crime complaints is calculated to be 16.38%.


###Looking at the total public crime complaints monthly between 2010 to 2017
``` {r echo= FALSE, message = FALSE, warning = FALSE}
ggplot(data = AllComplaint, aes(Year_Month)) + 
  geom_line(stat = "count") + 
  geom_point(stat = "count") + 
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Per Month Between 2010 to 2017") +
  theme(plot.title = element_text(hjust = 0.5))
```

There is a trend of decrease in public crime complaints every year between the month of November, December, and January. The crime complaints start to increase after January and reaches the peak around the month of June and July of each year and drop again after.

###Looking at the total public crime complaints per borough between the year 2010 to 2017 
``` {r echo = FALSE}
ggplot((AllComplaint)) + 
  geom_bar( aes(x = Borough, y =  (..count..)), col = "red") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Per Borough Between 2010 to 2017") +
  theme(plot.title = element_text(hjust = 0.5))
```

According to the bar graph above. It clearly shown that Staten Island have significantly less public crime complaints than the other four boroughs. This isbecause of the size of population in the boroughs. According to the website (city population), Staten Island only hold 5.6% of the New York City population. But Brookyln (population size of 2648771) shows to have significantly more public crime complaints than other boroughs even when Queens (population size of 2358582) have similar population size. Population size are determined by [City Population](https://www.citypopulation.de/php/usa-newyorkcity.php)
![New York City Boroughs Population Estimate](Population.png)

```{r echo = TRUE}
(length(which(AllComplaint$Borough == "BRONX")) /1471160)*100
(length(which(AllComplaint$Borough == "BROOKLYN")) /2648771)*100
(length(which(AllComplaint$Borough == "MANHATTAN")) /1664727)*100
(length(which(AllComplaint$Borough == "QUEENS")) /2358582)*100
(length(which(AllComplaint$Borough == "STATEN ISLAND")) /479458)*100
```


```{r echo= FALSE}
a <- (length(which(AllComplaint$Borough == "BRONX")) /1471160)*100
b <- (length(which(AllComplaint$Borough == "BROOKLYN")) /2648771)*100
c <- (length(which(AllComplaint$Borough == "MANHATTAN")) /1664727)*100
d <- (length(which(AllComplaint$Borough == "QUEENS")) /2358582)*100
e <- (length(which(AllComplaint$Borough == "STATEN ISLAND")) /479458)*100
Capita <- data.frame(name = c("BRONX", "BROOKLYN", "MANHATTAN", "QUEENS", "STATEN ISLAND"), value = c(a,b,c,d,e))

ggplot(Capita, aes(x= name, y = value)) + geom_bar(stat = "identity") +
  xlab("Boroughs") +
  ylim(0, 10) +
  ylab("Total Public Crimes Complaints per 100 people") +
  ggtitle("Number of Public Crime Complaints per 100 people For Each Boroughs") +
  theme(plot.title = element_text(hjust = 0.5))
```

The complaint per capita is found by dividing the total public crime complaints with the population size for each boroughs. From the year of 2010 to 2017, there is a public crime complaint rate of 7.5 per 100 people in Bronx, 5.4 per 100 people in Brookyln, 6 per 100 people in Manhattan, 3.9 per 100 people in Queens, and 3.4 per 100 people in Staten Island. 

The number of public crimes complaints per 100 people for each boroughs bar graph show that Bronx have the most public crime complaints while Brooklyn have almost twice the amount of population. Staten Island have the least amount of population size and least amount of public crime complaints.

``` {r echo = FALSE, message = FALSE, warning = FALSE}
ggplot(AllComplaint, aes(x = Year, fill = Borough)) +
  geom_bar(position = "fill") +
  scale_fill_brewer(palette = "Dark2")+
  ylab("Percentage of The Total Number of Public Crimes Complaints") +
  ggtitle("Percentage of Public Crime Complaints Annually For The Five Boroughs")

ggplot(AllComplaint, aes(x = Year_Month, fill = Borough)) +
  geom_bar(position = "fill") +
  scale_fill_brewer(palette = "Dark2")+
  ylab("Percentage of The Total Number of Public Crimes Complaints") +
  ggtitle("Percentage of Public Crime Complaints Monthly For The Five Boroughs")
```

Both of the percentage of public crime complaints for each boroughs bar graph above shown that the percentage of public crime complaints did not have any significant changes monthly or yearly. Bronx's public crime complaints averaged around a little less than 25% of the total number of complaints. Brooklyn's public crime complaints averaged around 30% of the total number of complaints. Manhattan and Queens averaged around 20% of the total number of complaints. Staten Island averaged a little less than 5% of the total number of compaint.


``` {r echo = FALSE}
ggplot(AllComplaint, aes(x = Year, y = (..count..))) +
  geom_point(aes(col = Borough),stat = "count") +
  geom_line(aes(col = Borough), stat = "count") +
    scale_color_brewer(palette = "Dark2") +
  theme(panel.grid = element_blank()) +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Annual Total Public Crime Complaints for The Five Boroughs") +
  theme(plot.title = element_text(hjust = 0.5))
```

The annual total public crime complaints line graph above shown that Brookyln's public crime complaints have a more noticeable sight of decrease over the years than the other boroughs. 

``` {r echo = TRUE}
#Number of public crime complaints in 2010 and 2017 For Bronx
length(which(AllComplaint$Year== 2010 & AllComplaint$Borough == "BRONX"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Borough == "BRONX"))
#The percentage change in public crime complaints between 2010 and 2017 in Bronx
BX10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Borough == "BRONX"))
BX17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Borough == "BRONX"))
(BX10 - BX17)/BX10
#Number of public crime complaints in 2010 and 2017 For Brooklyn
length(which(AllComplaint$Year== 2010 & AllComplaint$Borough == "BROOKLYN"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Borough == "BROOKLYN"))
#The percentage change in public crime complaints between 2010 and 2017 in Brooklyn
BN10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Borough == "BROOKLYN"))
BN17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Borough == "BROOKLYN"))
(BN10 - BN17)/BN10
#Number of public crime complaints in 2010 and 2017 For Manhattan
length(which(AllComplaint$Year== 2010 & AllComplaint$Borough == "MANHATTAN"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Borough == "MANHATTAN"))
#The percentage change in public crime complaints between 2010 and 2017 in Manhattan
MN10 <- length(which(AllComplaint$Year== 2010 | AllComplaint$Borough == "MANHATTAN"))
MN17 <- length(which(AllComplaint$Year== 2017 | AllComplaint$Borough == "MANHATTAN"))
(MN10 - MN17)/MN10
#Number of public crime complaints in 2010 and 2017 For Queens
length(which(AllComplaint$Year== 2010 & AllComplaint$Borough == "QUEENS"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Borough == "QUEENS"))
#The percentage change in public crime complaints betwen 2010 and 2017 in Queens
QS10 <- length(which(AllComplaint$Year== 2010 | AllComplaint$Borough == "QUEENS"))
QS17 <- length(which(AllComplaint$Year== 2017 | AllComplaint$Borough == "QUEENS"))
(QS10 - QS17)/QS10
#Number of public crime complaints in 2010 and 2017 For Staten Island
length(which(AllComplaint$Year== 2010 & AllComplaint$Borough == "STATEN ISLAND"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Borough == "STATEN ISLAND"))
#The percentage change in public crime complaints between 2010 and 2017 in Staten Island
SD10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Borough == "STATEN ISLAND"))
SD17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Borough == "STATEN ISLAND"))
(SD10 - SD17)/SD10
```

To determine if the number of public crime complaints have increased or decreased for each boroughs between 2010 and 2017, the percentage changes in public crime complaints between 2010 and 2017 is calculated. 

The public crime complaints have decreased for all five boroughs at the end of 2017. Bronx decreased 17.3%, Brooklyn decreased  22.2%, Manhattan decreased 6.5%, Queens decreased 5.8%, and Staten Island decreased 27.5%.

``` {r echo = FALSE}
ggplot(AllComplaint, aes(x = as.Date(Year_Month), y = (..count..))) +
  geom_point(aes(col = Borough),stat = "count") +
  geom_line(aes(col = Borough), stat = "count") +
  scale_color_brewer(palette = "Dark2") +
  theme(panel.grid = element_blank()) +
  xlab("Year") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Monthly for The Five Borough") +
  theme(plot.title = element_text(hjust = 0.5))
```

The monthly complaints for the five boroughs line graph above once again shows that there is significantly less public crime complaints during the month of November, December, and January for each boroughs. And there is significantly more public crime complaints during the month of June, July, and August for each boroughs.

###Looking at the level of offenses
``` {r echo = FALSE}
ggplot(AllComplaint) +
  geom_bar( aes(x = Offense_Description, y = stat(count)), col = "red") +
  theme(panel.grid = element_blank()) +
  scale_fill_brewer(palette = "Set1") +
  xlab("Offense Description") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Annually Per Offense") +
  coord_flip()

Level <- AllComplaint$Level_of_Offense
ggplot(AllComplaint) +
  geom_bar( aes(x = Level, y = stat(count),fill = Offense_Description)) +
  theme(panel.grid = element_blank()) +
  scale_fill_brewer(palette = "Set1") +
  xlab("Offense Description") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Annually Per Offense") 
```

In the world of Criminal Justice, violations are considered to be the minor of offenses. Violations can be punishable by a fine and will not result in any jail or prison time. Misdemeanor offenses are a more serious than violation offenses. Misdemeanor can result up to one year in jail. Felonies are the most serious offense out of the three. Felonies are seperated by letter (Class A - Class E). Class A felonies are the most serious and class E is the least. The punishment are sorted by class (A: up to life time in prison, B:25 years+, C: 10 - 25 years, D: 5 - 10 years, and E: 1 - 5 years). [Legal Dictionary](https://legaldictionary.net/felony/)

Crimes such as arson, kidnapping, and rape are considered class A felonies, hence those crimes are the minority among the total public crime complaints. Robbery and felony assault are considered class B felonies, which is the majority of the number of public crime complaints. Sex crime and in the possession of danerous weapons are mixture of felony and misdemeanor. Assault and related offenses are the majority of misdemeanor offenses. And harrassment is only considered as violation. 

``` {r echo = FALSE}
ggplot(AllComplaint, aes(x = Year, y = (..count..))) +
  geom_point(aes(col = Offense_Description),stat = "count") +
  geom_line(aes(col = Offense_Description), stat = "count") +
  scale_color_brewer(palette = "Set1") +
  theme(panel.grid = element_blank()) +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Annual Total Public Crime Complaints Per Offenses")
```

The annual total public crime complaints per offenses line graph above shown that harrassment and sex crimes had clearly increased. The possession of dangerous weapons and robbery had clearly decreased. But other offenses are hard to tell.

``` {r echo = TRUE}
#Number of public crime complaints in 2010 and 2017 for arson 
length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "ARSON"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "ARSON"))
#The percentage change in public crime complaints between 2010 and 2017 for arson
AN10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "ARSON"))
AN17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "ARSON"))
(AN10 - AN17)/AN10
#Number of public crime complaints in 2010 and 2017 for assault & related offenses
length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "ASSAULT & RELATED OFFENSES"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "ASSAULT & RELATED OFFENSES"))
#The percentage change in public crime complaints between 2010 and 2017 for assault & related offenses
AT10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "ASSAULT & RELATED OFFENSES"))
AT17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "ASSAULT & RELATED OFFENSES"))
(AT10 - AT17)/AT10
#Number of public crime complaints in 2010 and 2017 for possession of dangerous weapons
length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "DANGEROUS WEAPONS"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "DANGEROUS WEAPONS"))
#The percentage change in public crime complaints between 2010 and 2017 for possession of dangerous weapons
DW10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "DANGEROUS WEAPONS"))
DW17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "DANGEROUS WEAPONS"))
(DW10 - DW17)/DW10
#Number of public crime complaints in 2010 and 2017 for felony assault
length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "FELONY ASSAULT"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "FELONY ASSAULT"))
#The percentage change in public crime complaints between 2010 and 2017 for felony assault
FA10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "FELONY ASSAULT"))
FA17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "FELONY ASSAULT"))
(FA10 - FA17)/FA10
#Number of public crime complaints in 2010 and 2017 for harrassment
length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "HARRASSMENT "))
length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "HARRASSMENT "))
#The percentage change in public crime complaints between 2010 and 2017 for harrassment
HT10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "HARRASSMENT "))
HT17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "HARRASSMENT "))
(HT10 - HT17)/HT10
#Number of public crime complaints in 2010 and 2017 for kidnapping
length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "KIDNAPPING"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "KIDNAPPING"))
#The percentage change in public crime complaints between 2010 and 2017 for kidnapping
KG10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "KIDNAPPING"))
KG17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "KIDNAPPING"))
(KG10 - KG17)/KG10
#Number of public crime complaints in 2010 and 2017 for rape
length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "RAPE"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "RAPE"))
#The percentage change in public crime complaints between 2010 and 2017 for rape
RE10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "RAPE"))
RE17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "RAPE"))
(RE10 - RE17)/RE10
#Number of public crime complaints in 2010 and 2017 for robbery
length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "ROBBERY"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "ROBBERY"))
#The percentage change in public crime complaints between 2010 and 2017 for robbery
RY10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "ROBBERY"))
RY17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "ROBBERY"))
(RY10 - RY17)/RY10
#Number of public crime complaints in 2010 and 2017 for sex crimes
length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "SEX CRIMES"))
length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "SEX CRIMES"))
#The percentage change in public crime complaints between 2010 and 2017 for sex crimes
SC10 <- length(which(AllComplaint$Year== 2010 & AllComplaint$Offense_Description == "SEX CRIMES"))
SC17 <- length(which(AllComplaint$Year== 2017 & AllComplaint$Offense_Description == "SEX CRIMES"))
(SC10 - SC17)/SC10
```

The percentage changes between 2010 and 2017 are once again calculated by using the formula above. Which helps to identify whether the offenses have decreased or increased in percentage. The percentage change in public crime complaints in 2017 from 2010: arson have decreased by 46.4%, assault & related offenses have decreased by 3.2%, possession of dangerous weapons have decreased by 46.7%, felony assault have decreased by 10.1%, harrassment have increased by 3.8%, kiddnapping have decreased by 31.3%, rape is unchanged, robbery have decreased by 38.6%, and sex crimes have increased by 25.6%.

###Looking at the premises description
``` {r echo = FALSE}
ggplot(AllComplaint) +
  geom_bar( aes(x = Year, y = stat(count), fill = Premises_Description)) +
  theme(panel.grid = element_blank()) +
  scale_fill_brewer(palette = "Paired") +
  ylab("Number of Public Crime Complaints") +
  ggtitle("Total Public Crime Complaints Annually in Different Premises") 

ggplot(AllComplaint, aes(x = Year, fill = Premises_Description)) +
  geom_bar(position = "fill") +
  scale_fill_brewer(palette = "Paired") +
  ylab("Percentage of Public Crime Complaints") +
  ggtitle("Percentage of The Total Public Crime Complaints Annually in Different Premises") 

```

Majority of the total public crime complaints are from the street. Over the years, the percentage of street complaints have decreased while the percentage of transit - NYC subway have increased. 

###Looking at the suspect's age group, race, and sex
``` {r echo = FALSE}
ggplot(data = AllComplaint, aes(AllComplaint$Suspect_Age_Group)) + 
  geom_bar(stat = "count", col = "red") +
  xlab("Suspect's Age Group") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints For Suspect's Age Group") +
  theme(plot.title = element_text(hjust = 0.5))

```
Majority of the data is NA because the suspect wasn't caught or seen. Most of the suspects that were reported were in the age group of 25-44.

```{r echo = FALSE}
ggplot(data = AllComplaint, aes(AllComplaint$Suspect_Race)) + 
  geom_bar(stat = "count", col = "red") +
  xlab("Suspect's Race") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints For The Suspect's Race") +
  theme(plot.title = element_text(hjust = 0.5)) +
  coord_flip()

ggplot(AllComplaint) +
  geom_bar( aes(x = AllComplaint$Suspect_Race, y = stat(count),fill = Borough)) +
  theme(panel.grid = element_blank()) +
  scale_fill_brewer(palette = "Dark2") +
  xlab("Suspect's Race") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints For The Suspect's Race")  +
  coord_flip()
```
Majority of the suspects that were reported were Black. Brooklyn have significant more Black suspects than other boroughs. Most of the Asian/Pacific Islander suspects were in Queens.


```{r echo = FALSE}
ggplot(data = AllComplaint, aes(AllComplaint$Suspect_Sex)) + 
  geom_bar(stat = "count", col = "red") +
  xlab("Suspect's Sex") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints For The Suspect's Sex") +
  theme(plot.title = element_text(hjust = 0.5))
```
Majority of the suspects that were reported were males. Male suspects are more than quadruple times the female suspects.

###Looking at the victim's age group, race, and sex
```{r echo = FALSE}
ggplot(data = AllComplaint, aes(AllComplaint$Victim_Age_Group)) + 
  geom_bar(stat = "count", col = "red") +
  ylab("Number of Public Crimes Complaints") +
  xlab("Victim's Age Group") +
  ggtitle("Total Public Crime Complaints For Victim's Age Group") +
  theme(plot.title = element_text(hjust = 0.5))
```
The age group of 25-44 is also the most total public crime complaint for the victim's age group.


```{r echo = FALSE}
ggplot(data = AllComplaint, aes(AllComplaint$Victim_Race)) + 
  geom_bar(stat = "count", col = "red") +
  xlab("Victim's Race") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints For The Victim's Race") +
  theme(plot.title = element_text(hjust = 0.5)) +
  coord_flip()

ggplot(AllComplaint) +
  geom_bar( aes(x = AllComplaint$Victim_Race, y = stat(count),fill = Borough)) +
  theme(panel.grid = element_blank()) +
  scale_fill_brewer(palette = "Dark2") +
  xlab("Victim Race") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints For The Victim's Race")  +
  coord_flip()
```
Blacks are also the majority of the victim's race. Majority of the black victims were reported in Brooklyn. Asian/Pacific Islander victims were mostly reported in Queens.

```{r echo = FALSE}
ggplot(data = AllComplaint, aes(AllComplaint$Victim_Sex)) + 
  geom_bar(stat = "count", col = "red") +
  xlab("Victim's Sex") +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints For The Victim's Sex") +
  theme(plot.title = element_text(hjust = 0.5))
```
There are a lot more female victims than female suspects.

### Comparing average temperature of the day with number of crime complaints 
``` {r echo = FALSE, message = FALSE, warning = FALSE}
ggplot(data = AllComplaint, aes(Year_Month)) + 
  geom_line(stat = "count", col = "red") + 
  geom_point(stat = "count", col = "red") + 
  ylab("Number of Public Crime Complaints") +
  ggtitle("Total Public Crime Complaints Per Month Between 2010 to 2017") +
  theme(plot.title = element_text(hjust = 0.5))

Date <- AllComplaint$Complaint_Date
Temperature <- AllComplaint$Average.Temperature
ggplot(AllComplaint, aes(x = as.Date(Date), y = Temperature)) +
  geom_point() +
  scale_x_date(date_labels =  "%B-%Y", date_breaks = "1 year") +
  ylim(0, 100) +
  scale_y_continuous(breaks = c(10,20,30,40,50,60,70,80,90,100)) +
  xlab("Year") +
  ggtitle("Daily Average Temperature Between 2010 to 2017") +
  theme(plot.title = element_text(hjust = 0.5))
 
```
![Daily Avg Temperature and Total Public Crime Complaint](Temp+Complaint.png)

By compare the temperature with the total public crime The figure shows a strong correlation between the daily average temperature and total crime complaint over the year of 2010 to 2017. As the temperature decrease, the public crime decreases as well and as the temperature increase, the public crime complaints increases as well.

###Looking at the 3 shifts
``` {r echo = T}
#Total public crime complaints during shift 1 
nrow(Shift1)
#Total public crime complaints during shift 2 
nrow(Shift2)
#Total public crime complaints during shift 3
nrow(Shift3)
```

From the nrow function, Shift 3 (hour 16:00 - 24:00) was found to have the most public crime complaints. Shift 1 have 118733 complaints, shift 2 have 145766 complaints, and shift 3 have 197408 complaints.

```{r echo = FALSE}
ggplot((Shift1)) + 
  geom_bar( aes(x = Borough, y =  (..count..)), fill = "red") +
  ylab("Number of Public Crime Complaints") +
  ylim(0, 65000) +
  ggtitle("Public Crime Complaints Between 2010 to 2017 During Shift 1") 
```

```{r echo = FALSE}
ggplot((Shift2)) + 
  geom_bar( aes(x = Borough, y =  (..count..)), fill = "blue") +
  ylab("Number of Public Crime Complaints") +
  ylim(0, 65000) +
  ggtitle("Public Crime Complaints Between 2010 to 2017 During Shift 2")
```

```{r echo = FALSE}
ggplot((Shift3)) + 
  geom_bar( aes(x = Borough, y =  (..count..)), fill ="green") +
  ylab("Number of Public Crime Complaints") +
  ylim(0, 65000) +
  ggtitle("Public Crime Complaints Between 2010 to 2017 During Shift 3")
```
![Public Crime Complaints Per Borough Between 2010 to 2017 During all Shifts](Shifts.png)
Graphs shows that Shift1 have the least amount of crime complaints, followed by shift2 and shift3 have the most amount of crime complaints. There are less number of public crime complaints in Bronx than Manhattan and about the same number of public crime complaints in Queens during shift1. But Bronx surpasses Manhattan and Queens number of public crime complaints during shift2 and shift3.

``` {r echo = FALSE, message = FALSE, warning = FALSE}
ggplot(data = Shift1, aes(Year_Month)) + 
  geom_line(stat = "count", col = "red") +
  geom_point(stat = "count", col = "red") + 
  ylim(500, 3000) +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Per Month During Shift 1") +
  theme(plot.title = element_text(hjust = 0.5))
 
ggplot(data = Shift2, aes(Year_Month)) + 
  geom_line(stat = "count", col = "blue") +
  geom_point(stat = "count", col = "blue") + 
  ylim(500, 3000) +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Per Month During Shift 2") +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(data = Shift3, aes(Year_Month)) + 
  geom_line(stat = "count", col = "green") +
  geom_point(stat = "count", col = "green") + 
  ylim(500, 3000) +
  ylab("Number of Public Crimes Complaints") +
  ggtitle("Total Public Crime Complaints Per Month During Shift 3") +
  theme(plot.title = element_text(hjust = 0.5))
```
![Total Public Crime Complaints Per Month Between Shifts](layer.png)
the stacked line graph above shown that in every year during the month of june, july, and august, the number of crime complaints in shift1 spiked up while shift2 decreases. This could be effect of summer time, the average temperature are warmer and students are in summer vacations.


Load  the library for plotting heatmap
```{r message = FALSE}
library(ggplot2)
library(ggthemes)
library(viridis)
library(ggmap)
library(scales)
library(grid)
library(gridExtra)
library(tigris)
library(leaflet)
library(sp)
library(maptools)
library(broom)
library(httr)
library(rgdal)
```

``` {r echo = FALSE}
register_google(key = "AIzaSyDUkHqG3g9Jcpxc-iiJLozLD8up7UV8KQo")
Manhattan <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/MANHATTAN.csv", header = T)[,-1]
Brooklyn <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/BROOKLYN.csv", header = T)[,-1]
Bronx <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/BRONX.csv", header = T)[,-1]
Queens <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/QUEENS.csv", header = T)[,-1]
StatenIsland <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/STATEN ISLAND.csv", header = T)[,-1]


Bronx_Shift1 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift1 Bronx.csv", header = T)[,-1]
Brooklyn_Shift1 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift1 Brooklyn.csv", header = T)[,-1]
Manhattan_Shift1 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift1 Manhattan.csv", header = T)[,-1]
Queens_Shift1 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift1 Queens.csv", header = T)[,-1]
StatenIsland_Shift1 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift1 StatenIsland.csv", header = T)[,-1]

Bronx_Shift2 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift2 Bronx.csv", header = T)[,-1]
Brooklyn_Shift2 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift2 Brooklyn.csv", header = T)[,-1]
Manhattan_Shift2 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift2 Manhattan.csv", header = T)[,-1]
Queens_Shift2 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift2 Queens.csv", header = T)[,-1]
StatenIsland_Shift2 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift2 StatenIsland.csv", header = T)[,-1]

Bronx_Shift3 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift3 Bronx.csv", header = T)[,-1]
Brooklyn_Shift3 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift3 Brooklyn.csv", header = T)[,-1]
Manhattan_Shift3 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift3 Manhattan.csv", header = T)[,-1]
Queens_Shift3 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift3 Queens.csv", header = T)[,-1]
StatenIsland_Shift3 <- read.csv("C:/Users/Jayden/Desktop/Springboard/Data Story/Shift3 StatenIsland.csv", header = T)[,-1]
```

###Looking at the heatmap for NYC and each boroughs
``` {r echo = FALSE, message = FALSE, warning = FALSE}
Lat <- AllComplaint$Latitude
Lon <- AllComplaint$Longitude 
nyc_map1 <- get_map(location = c(lon = -73.90, lat = 40.71), maptype = "terrain", zoom = 10)
nyc <- ggmap(nyc_map1)
nyc + stat_density2d(data=AllComplaint, aes(x = Lon, y = Lat, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("New York City Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
The hotspots for crime complaints in New York City are in lower Manhattan, upper Manhattan, and lowerleft of Bronx.

###Looking at the heatmap for Manhattan
``` {r echo = FALSE, message = FALSE, warning = FALSE}
man_lon <- Manhattan$Longitude
man_lat <- Manhattan$Latitude
manhattan_map <- get_map(location = c(lon = -73.95, lat = 40.79), maptype = "terrain", zoom = 12)
man <- ggmap(manhattan_map)
man + stat_density2d(data=Manhattan, aes(x = man_lon, y = man_lat, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Manhattan Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
The hotspots for crime complaints in Manhattan are in between Hell's Kitchen and midtown, and as well as in Harlem and upper Manhattan

###Looking at the heatmap for Brooklyn
``` {r echo = FALSE, message = FALSE, warning = FALSE}
brook_lon <- Brooklyn$Longitude
brook_lat <- Brooklyn$Latitude
brooklyn_map <- get_map(location = c(lon = -73.94, lat = 40.68), maptype = "terrain", zoom = 11)
brook <- ggmap(brooklyn_map)
brook + stat_density2d(data=Brooklyn, aes(x = brook_lon, y = brook_lat, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Brooklyn Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
The hotspots for crime complaints in Brooklyn are everywhere in the middle of Brooklyn Height, Flatbush Ditmas Park and Highlan Park.

###Looking at the heatmap for Bronx
``` {r echo = FALSE, message = FALSE, warning = FALSE}
bronx_lon <- Bronx$Longitude
bronx_lat <- Bronx$Latitude
bronx_map <- get_map(location = c(lon = -73.86, lat = 40.84), maptype = "terrain", zoom = 12)
bronx <- ggmap(bronx_map)
bronx + stat_density_2d(data=Bronx, aes(x = bronx_lon, y = bronx_lat, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Bronx Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
The hotspots for crime complaints in Bronx are in Fordham Heights, Morrisania, Mott Haven, and Soundview.

``` {r echo = FALSE, message = FALSE, warning = FALSE}
queens_lon <- Queens$Longitude
queens_lat <- Queens$Latitude
queens_map <- get_map(location = c(lon = -73.82, lat = 40.74), maptype = "terrain", zoom = 11)
queens <- ggmap(queens_map)
queens + stat_density2d(data=Queens, aes(x = queens_lon, y = queens_lat, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Queens Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
The hotspots for crime complaints in Queens are in Jackson Heights and Jamaica.

``` {r echo = FALSE, message = FALSE, warning = FALSE}
staten_lon <- StatenIsland$Longitude
staten_lat <- StatenIsland$Latitude
staten_map <- get_map(location = c(lon = -74.15, lat = 40.58), maptype = "terrain", zoom = 12)
staten <- ggmap(staten_map)
staten + stat_density2d(data=StatenIsland, aes(x = staten_lon, y = staten_lat, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Staten Island Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
The hotspots for crime complaints in Staten Island are ST. George and snug Harbor Cultural Center & Botanical Garden.


###Comparing the hotspots in Manhattan by shifts
``` {r echo = FALSE, message = FALSE, warning = FALSE}
Manhattan_lon_Shift1 <- Manhattan_Shift1$Longitude
Manhattan_lat_Shift1 <- Manhattan_Shift1$Latitude
Manhattan_lon_Shift2 <- Manhattan_Shift2$Longitude
Manhattan_lat_Shift2 <- Manhattan_Shift2$Latitude
Manhattan_lon_Shift3 <- Manhattan_Shift3$Longitude
Manhattan_lat_Shift3 <- Manhattan_Shift3$Latitude

man + stat_density2d(data = Manhattan_Shift1, aes(x = Manhattan_lon_Shift1, y = Manhattan_lat_Shift1, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Manhattan Shift 1 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

man + stat_density2d(data = Manhattan_Shift2, aes(x = Manhattan_lon_Shift2, y = Manhattan_lat_Shift2, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Manhattan Shift 2 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

man + stat_density2d(data = Manhattan_Shift3, aes(x = Manhattan_lon_Shift3, y = Manhattan_lat_Shift3, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Manhattan Shift 3 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
Shift1 Manhattan hotspots: Between Hell's Kitchen and Midtown, Lower Manhattan (Greenwich Village and Bowery).
Shift2 Manhattan hotspots: Between Hell's Kitchen and Midtown, East Village, and between Harlem and East Harlem.
Shift3 Manhattan hotspots: Between Hell's Kitchen and Midtow and between Harlem and East Harlem.

###Comparing the hotspots in Bronx by shifts
``` {r echo = FALSE, message = FALSE, warning = FALSE}
Bronx_lon_Shift1 <- Bronx_Shift1$Longitude
Bronx_lat_Shift1 <- Bronx_Shift1$Latitude
Bronx_lon_Shift2 <- Bronx_Shift2$Longitude
Bronx_lat_Shift2 <- Bronx_Shift2$Latitude
Bronx_lon_Shift3 <- Bronx_Shift3$Longitude
Bronx_lat_Shift3 <- Bronx_Shift3$Latitude

bronx + stat_density2d(data=Bronx_Shift1, aes(x = Bronx_lon_Shift1, y = Bronx_lat_Shift1, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Bronx Shift 1 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

bronx + stat_density2d(data=Bronx_Shift2, aes(x = Bronx_lon_Shift2, y = Bronx_lat_Shift2, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Bronx Shift 2 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

bronx + stat_density2d(data=Bronx_Shift3, aes(x = Bronx_lon_Shift3, y = Bronx_lat_Shift3, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Bronx Shift 3 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
Shift1 Bronx hotspots: Morris Heights, Highbridge, Mott Haven, Morrisania and Soundviews.
Shift2 Bronx hotspots: Morris Heights, Highbridge, Mott Haven, Morrisania and Soundviews.
Shift3 Bronx hotspots: Morris Heights, Highbridge

###Comparing the hotspots in Brooklyn by shifts
``` {r echo = FALSE, message = FALSE, warning = FALSE}
Brooklyn_lon_Shift1 <- Brooklyn_Shift1$Longitude
Brooklyn_lat_Shift1 <- Brooklyn_Shift1$Latitude
Brooklyn_lon_Shift2 <- Brooklyn_Shift2$Longitude
Brooklyn_lat_Shift2 <- Brooklyn_Shift2$Latitude
Brooklyn_lon_Shift3 <- Brooklyn_Shift3$Longitude
Brooklyn_lat_Shift3 <- Brooklyn_Shift3$Latitude

brook + stat_density2d(data=Brooklyn_Shift1, aes(x = Brooklyn_lon_Shift1, y = Brooklyn_lat_Shift1, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Brooklyn Shift 1 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

brook + stat_density2d(data=Brooklyn_Shift2, aes(x = Brooklyn_lon_Shift2, y = Brooklyn_lat_Shift2, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Brooklyn Shift 2 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

brook + stat_density2d(data=Brooklyn_Shift3, aes(x = Brooklyn_lon_Shift3, y = Brooklyn_lat_Shift3, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Brooklyn Shift 3 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
Shift1 Brooklyn hotspots: Sunset Park, Upper half of Brooklyn.
Shift2 Brooklyn hotspots:Brooklyn Heights
Shift3 Brooklyn hotspots: Upper half of Brooklyn.


###Comparing the hotspots in Queens by shifts
``` {r echo = FALSE, message = FALSE, warning = FALSE}
Queens_lon_Shift1 <- Queens_Shift1$Longitude
Queens_lat_Shift1 <- Queens_Shift1$Latitude
Queens_lon_Shift2 <- Queens_Shift2$Longitude
Queens_lat_Shift2 <- Queens_Shift2$Latitude
Queens_lon_Shift3 <- Queens_Shift3$Longitude
Queens_lat_Shift3 <- Queens_Shift3$Latitude

queens + stat_density2d(data= Queens_Shift1, aes(x = Queens_lon_Shift1, y = Queens_lat_Shift1, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Queens Shift 1 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

queens + stat_density2d(data= Queens_Shift2, aes(x = Queens_lon_Shift2, y = Queens_lat_Shift2, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Queens Shift 2 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

queens + stat_density2d(data= Queens_Shift3, aes(x = Queens_lon_Shift3, y = Queens_lat_Shift3, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Queens Shift 3 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
Shift1 Queens hotspots: Jackson Heights
Shift2 Queens hotspots: Jamaica
Shift3 Queens hotspots: Jackson Heights and Jamaica

###Comparing the hotspots in Staten Island by shifts
``` {r echo = FALSE, message = FALSE, warning = FALSE}
StatenIsland_lon_Shift1 <- StatenIsland_Shift1$Longitude
StatenIsland_lat_Shift1 <- StatenIsland_Shift1$Latitude
StatenIsland_lon_Shift2 <- StatenIsland_Shift2$Longitude
StatenIsland_lat_Shift2 <- StatenIsland_Shift2$Latitude
StatenIsland_lon_Shift3 <- StatenIsland_Shift3$Longitude
StatenIsland_lat_Shift3 <- StatenIsland_Shift3$Latitude

staten + stat_density2d(data= StatenIsland_Shift1, aes(x = StatenIsland_lon_Shift1, y = StatenIsland_lat_Shift1, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Staten Island Shift 1 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

staten + stat_density2d(data= StatenIsland_Shift2, aes(x = StatenIsland_lon_Shift2, y = StatenIsland_lat_Shift2, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Staten Island Shift 2 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))

staten + stat_density2d(data= StatenIsland_Shift3, aes(x = StatenIsland_lon_Shift3, y = StatenIsland_lat_Shift3, fill = ..level..), alpha = .1, geom = "polygon", size =0.5, bins=40) +
  scale_fill_gradient(low =  "green", high = "red") +
  ggtitle("Staten Island Shift 3 Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```
Shift1 Staten Island hotspots: ST George, Tompkinsville, and Snug Harbor Cultureal Center & Botanical Garden.
Shift2 Staten Island hotspots: ST George.
Shift3 Staten Island hotspots: ST George, Tompkinsville, and Snug Harbor Cultureal Center & Botanical Garden.


#Machine Learning Linear Regression
Load  the library
```{r message = FALSE}
library(caTools)
```
Load the dataframe
``` {r echo = FALSE}
holiday <- read.csv("C:/Users/Jayden/Desktop/new daily precipitation 4.csv", header = T, stringsAsFactors = F)[,-c(1,10)]


holiday$Complaint_Date <- lubridate::mdy(holiday$Complaint_Date)
holiday <- holiday[order(as.Date(holiday$Complaint_Date, format = "%d/%m/%Y")),]
holiday$Precipitation_Greater_3inches <- as.factor(holiday$Precipitation_Greater_3inches)
holiday$Federal_Holidays_Description<- as.factor(holiday$Federal_Holidays_Description)
holiday$Public_Schools_Closed_Description<- as.factor(holiday$Public_Schools_Closed_Description)
holiday$Federal_Holidays <- as.factor(holiday$Federal_Holidays)
holiday$Public_Schools_Closed<- as.factor(holiday$Public_Schools_Closed)
```

```{r echo = TRUE}
str(holiday)
```
The dataframe have 8 columns. The columns are: The complaint date, number of complaints of that day, average temperature of that day, if that day have precipitation greater than 3 inches, federeal holidays descriptions, federal holidays, public schools closed decriptions, and public schools closed.
Precipitation greater than 3 inches have two factor levels, if the day have a precipitation greater than 3 inches then it will be "1 Yes" and if not then it will be "0 No".
Federal holidays have two factors levels, if the day is a federal holiday then it will be "1 Yes" and if not then it will be "0 No".
Public Schools Closed have two factors levels, if public school is closed for the day then it will be "1 Yes" and if not then it will be "0 No".

```{r echo = TRUE}
#18 factor levels of holiday description
levels(holiday$Federal_Holidays_Description)
#21 factor levels of public school closed description
levels(holiday$Public_Schools_Closed_Description)
```



###Linear Regression Model with Number of complaints as dependent variable and average temperature of the day as independent variable and looking at the summary
``` {r echo = FALSE}
Avg.Temp <- lm(Number_of_Complaints~Average_Temperature, data = holiday)
summary(Avg.Temp)
```
By looking at the summary, the average temperature as the independent variable is very significant to number of complaints as the dependent variable ('***') according to the the significant codes. The summary shows a positive estimate, which means as the average temperature increase, the number of complaints increases as well.

###Linear Regreassion Model with Number of complaints as dependent variable and precipitation greater than 3 inches as independent variables and looking at the summary
``` {r echo = FALSE}
Precipitation <- lm(Number_of_Complaints~Precipitation_Greater_3inches, data = holiday)
summary(Precipitation)
```
By looking at the summary, the precipitation greater than 3 inches as the independent variable is very significant to number of complaints as the dependent variable ('***') according to the the significant codes. The summary shows a negative estimate, which means when there is a day that have precipitation greater than 3 inches, the number of complaints decreases.

###Linear Regreassion Model with Number of complaints as dependent variable and Federal holiday description as independent variable and looking at the summary
``` {r echo = FALSE}
Fed.hol.desc <- lm(Number_of_Complaints~Federal_Holidays_Description, data = holiday)
summary(Fed.hol.desc)
```
By looking at the summary, the federal holidays descripitions as the independent variables have different significant factor level to number of complaints as the dependent variable. Factor levels of "Christmas Day", "Martin Luther King Jr. Day", "New Year", "Thankgiving Day", and "Presidents' Day" are very significant with ('3stars'). Factor levels of "Christmas Day (lieu)", "Day after Thanksgiving", "Independence Day", and "Labor Day" are significant with ('2stars'). Factor level of "Lincoln's Birthday" are significant with ('1star'). Factor level of "New Year's Day (lieu)" are significant with ('.'). Factor levels of "Columbus Day", "Election Day", "Independence Day (lieu)", "Memorial Day", "Veterans Day", and "Veterans Day (lieu)" are not significant at all. The summary shows a postive estimate on "New Year's Day", "Independence Day", and "Labor Day" for the significant independent variables. The summary shows a negative estimate on "Christmas Day", "Chrismas Day (lieu)", "Day after Thanksgiving", "Lincolin's Birthday", "Martin Luther King Jr. Day", "New Year's Day (lieu)", "Presidents' Day", and "Thanksgiving Day".

###Linear Regreassion Model with Number of complaints as dependent variable and Federal holiday as independent variable and looking at the summary
``` {r echo = FALSE}
Fed.hol <- lm(Number_of_Complaints~Federal_Holidays, data = holiday)
summary(Fed.hol)
```
By looking at the summary, federal holiday as the independent variable is very significant to number of complaints as the dependent variable ('***') according to the the significant codes. The summary shows a negative estimate, which means when there is a federal holiday, the number of complaints decreases overall.

###Linear Regreassion Model with Number of complaints as dependent variable and Public school closed descriptions as independent variable and looking at the summary
``` {r echo = FALSE}
Publ.Sch.Clo.Des <- lm(Number_of_Complaints~Public_Schools_Closed_Description, data = holiday)
summary(Publ.Sch.Clo.Des)
```
By looking at the summary, the public school closed descripitions as the independent variables have different significant factor level to number of complaints as the dependent variable. Factor levels of "Midwinter Recess", "Martin Luther King Jr. Day", "Thanksgiving Recess", "Winter Recess", and "Presidents' Day" are very significant with ('3stars'). Factor levels of "Summer Vacation" and " Labor Day" are significant with ('1star'). Factor levels of "Election Day" and "Spring Recess" are significant with ('.'). Factor levels of "Clerical Day", "Columbus Day", "al-Adha", "al-Fitr", "Good Friday", "Memorial Day", "Rosh Hashanah", "Veterans Day", "Weekend", and "Yom Kippur" are not significant at all. The summary shows a postive estimate on "Labor Day" and "Summer Vacation" for the significant independent variables. The summary shows a negative estimate on "Election Day", "Midwinter Recess", "Martin Luther King Jr. Day", "Presidents' Day", "Spring Recess", "Thankgiving Recess", and "Winter Recess" for the significant independent variables.

###Linear Regreassion Model with Number of complaints as dependent variable and Public school closed as independent variable and looking at the summary
``` {r echo = FALSE}
Publ.Sch.Clo <- lm(Number_of_Complaints~Public_Schools_Closed, data = holiday)
summary(Publ.Sch.Clo)
```
By looking at the summary, public school closed as the independent variable is significant to number of complaints as the dependent variable ('.') according to the the significant codes. The summary shows a postive estimate, which means when public school close, the number of complaints increases overall.


###Linear Regression Model with Number of complaints as dependent variable and average temperature of the day with precipitation greater than 3 inches as independent variables and looking at the summary (Holiday.Model1)
``` {r echo = FALSE}
holiday.model1 <- lm(Number_of_Complaints~ Average_Temperature+Precipitation_Greater_3inches, data = holiday)
summary(holiday.model1)
```
Both average temperature of the day and precipitation greater than 3 inches are very significant to the number of complaints ('***'). The multiple R-square increased from 0.482 to 0.5262.

###Linear Regression Model with Number of complaints as dependent variable and average temperature of the day with precipitation greater than 3 inches and federal holidays as independent variables and looking at the summary (Holiday.Model2)
``` {r echo = FALSE}
holiday.model2 <- lm(Number_of_Complaints~ Average_Temperature+Precipitation_Greater_3inches+Federal_Holidays, data = holiday)
summary(holiday.model2)
```
The independent variable of average temperature of the day, precipitation greater than 3 inches, and federal holiday are very significant to the number of complaints ('***'). The multiple R-square increased from 0.5262 to 0.5304.

###Linear Regression Model with Number of complaints as dependent variable and average temperature of the day with precipitation greater than 3 inches, federal holidays, public school closed as independent variables and looking at the summary (Holiday.Model3)
``` {r echo = FALSE}
holiday.model3 <- lm(Number_of_Complaints~ Average_Temperature+Precipitation_Greater_3inches+Federal_Holidays+Public_Schools_Closed, data = holiday)
summary(holiday.model3)
```
When the public school closed independent variable is added to the linear regression model, the federal holidays significance decrease to ('**'). All other independent variables have the significant code ('3stars'). The multiple R-square increased from 0.5304 to 0.5488.

###Looking at the RMSE(root mean square error)
``` {r echo = TRUE}
##RMSE for Holiday.Model1
SSE.model1 <- sum(holiday.model1$residuals^2)
SSE.model1
RMSE.model1 <- sqrt(SSE.model1/nrow(holiday))
RMSE.model1
##RMSE for Holiday.Model2
SSE.model2 <- sum(holiday.model2$residuals^2)
SSE.model2
RMSE.model2 <- sqrt(SSE.model2/nrow(holiday))
RMSE.model2
##RMSE for Holiday.Model2
SSE.model3 <- sum(holiday.model3$residuals^2)
SSE.model3
RMSE.model3 <- sqrt(SSE.model3/nrow(holiday))
RMSE.model3
```
The root mean square error is the least on model3 and the multiple r-squared is the largest in model3. I will be using model3 for prediction.

### Splitting the data into training and test data
```{r echo = TRUE}
set.seed(314)
holiday.split <- sample.split(holiday$Number_of_Complaints, SplitRatio =  0.65)
holiday.train <- holiday[ holiday.split == TRUE, ]
nrow(holiday.train)
holiday.test <- holiday[ holiday.split == FALSE, ]
nrow(holiday.test)
```
The dataset is splitted into training set and testing set. 65% is in the training set and 35% is in the testing set.

### Creating the model
```{r echo = TRUE}
holiday.model3.train <- lm(Number_of_Complaints~ Average_Temperature+Precipitation_Greater_3inches+Federal_Holidays+Public_Schools_Closed, data = holiday.train)
summary(holiday.model3.train)
```
The independent variable of federal holidays decreased to ('*') on the significant level for the train set but the multiple r-squared have increased from 0.5488 to 0.557.

### Prediction
```{r echo = TRUE}
holiday.pred <- predict(holiday.model3.train, holiday.test)
```


###Comparing predicted vs actual values
```{r echo = FALSE}
plot(holiday.test$Number_of_Complaints, type = "l", lty = 1.8, col = "blue")
lines(holiday.pred, type = "l", col = "red")
```
The test set number of complaints is in blue and the prediction is in red.

```{r echo = FALSE}
plot(holiday.pred, type = "l",lty = 1.8, col = "red")
```
Showing only the prediction

#*Conclusion*

The public crime complaints in New York City have decreased 16.38% at the end of 2017 from the year of 2010. 
Brooklyn is the borough in New York City that have the most public crime activity that violate pedestrians but Bronx have the most number of public crime complaints if it was counted by per capita. 
There is a low-moderate effect of 0.482 (R-squared) between public crime activity and weather temperature. But after adding precipitation, federal holiday, and public school closed as the independent variable with average temperature of the day, the R-square increased to 0.5304. 
The most crime activity happens at shift3 in the hours of 16:01 - 24:00. 
To avoid the hotspots for the five borough, the heatmaps of each borough along shifts time of each borough are shown above.